// Prisma Schema for Habit Tracker
// Database: PostgreSQL

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User Model
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   // bcrypt hashed
  name      String?

  // Preferences
  stepGoal     Int      @default(10000)
  reminderTime String   @default("20:00") // HH:MM format
  timezone     String   @default("UTC")
  theme        String   @default("light") // 'light' or 'dark'

  // Status flags
  isEmailVerified Boolean @default(false)
  isActive        Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  habits      Habit[]
  completions Completion[]

  @@map("users")
}

// Habit Model
model Habit {
  id        String   @id @default(uuid())
  userId    String
  title     String
  monthlyGoal Int     @default(20) // 1-31 days per month
  color     String   @default("#6C63FF") // Hex color
  icon      String?  // Emoji or icon name

  // Notification settings
  notificationsEnabled Boolean @default(false)
  reminderTime        String? // HH:MM format

  // Timestamps
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  archivedAt DateTime? // Soft delete

  // Relations
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  completions Completion[]

  @@index([userId])
  @@index([userId, archivedAt])
  @@map("habits")
}

// Completion Model
model Completion {
  id          String   @id @default(uuid())
  habitId     String
  userId      String
  date        DateTime @db.Date // Just the date (YYYY-MM-DD)
  completedAt DateTime @default(now()) // Full timestamp

  // Relations
  habit Habit @relation(fields: [habitId], references: [id], onDelete: Cascade)
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Ensure one completion per habit per day
  @@unique([habitId, date])
  @@index([userId, date])
  @@index([habitId, date])
  @@map("completions")
}
